{% extends "base.html" %}

{% block content %}
<div class="card">
    <h2>Verify & Edit Allergens</h2>
    <p style="color: var(--text-muted); margin-bottom: 2rem;">Review the allergens for your items. Changes made here
        will apply <strong>only to this file</strong> and will not
        affect the database.</p>

    <form method="POST" action="/verify_generate">
        <div style="margin-bottom: 2rem;">
            {% for item in items %}
            {% set outer_index = loop.index0 %}
            <div class="item-card">
                <div class="item-header">
                    <div class="item-title">
                        <span class="item-badge">#{{ loop.index }}</span>
                        <input type="text" name="name_{{ outer_index }}" value="{{ item.name }}"
                            style="border: none; background: transparent; font-weight: 600; font-size: 1.1rem; color: var(--text-main); width: auto; min-width: 200px; padding: 0;">
                    </div>
                    <div
                        style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-muted); font-size: 0.9rem;">
                        <span>{{ item.calories }} kcal</span>
                        <input type="hidden" name="calories_{{ outer_index }}" value="{{ item.calories }}">
                    </div>
                </div>

                <div class="checkbox-grid">
                    {% for allergen in valid_allergens %}
                    <label class="checkbox-item" {% if allergen in item.allergens_list
                        %}style="background-color: #eef2ff; border-color: #c7d2fe;" {% endif %}>
                        <input type="checkbox" name="allergens_{{ outer_index }}" value="{{ allergen }}" {% if allergen
                            in item.allergens_list %}checked{% endif %}>
                        {{ allergen }}
                    </label>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Hidden field to track count -->
        <input type="hidden" name="item_count" value="{{ items|length }}">

        <div style="display: flex; justify-content: flex-end; gap: 1rem; margin-top: 2rem;">
            <a href="/" class="btn secondary" style="width: auto;">Cancel</a>
            <button type="submit" class="btn primary" style="width: auto;">
                Generate Excel
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
            </button>
        </div>
    </form>
</div>
{% endblock %}